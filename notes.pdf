<?php
require 'config.php';
// we will show list server-side for SEO & simple fallback
$stmt = $pdo->query("SELECT * FROM pdfs ORDER BY uploaded_at DESC");
$pdfs = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!doctype html><html><head>
<title>Notes - CS Study Hub</title>
<link rel="stylesheet" href="styles.css">
</head><body>
<header>
  <h1>CS Study Hub</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="materials.html">Materials</a>
    <a class="active" href="notes.php">Notes</a>
    <a href="contact.html">Contact</a>
    <?php if(isset($_SESSION['user_id'])): ?>
      <a href="dashboard.php">Dashboard</a>
      <a href="logout.php">Logout</a>
    <?php else: ?>
      <a href="login.php">Login</a>
    <?php endif;?>
  </nav>
</header>

<section class="section">
  <h2>PDF Notes</h2>

  <?php if(count($pdfs) === 0): ?>
    <p>No notes uploaded yet.</p>
  <?php else: ?>
    <div class="pdf-list">
      <?php foreach($pdfs as $p): ?>
        <div class="card pdf-card">
          <h3><?php echo htmlspecialchars($p['title']); ?></h3>
          <p>Uploaded on <?php echo $p['uploaded_at']; ?></p>
          <button class="btn viewPdf" data-file="<?php echo htmlspecialchars($p['filename']); ?>">View</button>
          <a class="btn" href="pdfs/<?php echo htmlspecialchars($p['filename']); ?>" download>Download</a>
        </div>
      <?php endforeach; ?>
    </div>
  <?php endif; ?>
</section>

<!-- Modal for viewer -->
<div id="pdfModal" class="modal" style="display:none;">
  <div class="modal-inner">
    <button id="closeModal" class="btn">Close</button>
    <div id="pdfContainer" style="height:80vh;">
      <iframe id="pdfFrame" src="" style="width:100%; height:100%; border:none;"></iframe>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body></html>
